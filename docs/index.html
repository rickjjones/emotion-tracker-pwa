<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <title>Emotion Tracker</title>
    <meta name="theme-color" content="#4CAF50">
    <link rel="manifest" href="manifest.json"> <!-- removed leading slash -->
    <link rel="icon" href="icon-192x192.png">    <!-- removed leading slash -->
</head>
<body>
    <div class="container">
        <h1>Emotion Tracker</h1>
        <form id="emotion-form">
            <div class="emotion">
                <label for="happiness">Happiness:</label>
                <input type="number" id="happiness" name="happiness" min="1" max="10">
            </div>
            <div class="emotion">
                <label for="sadness">Sadness:</label>
                <input type="number" id="sadness" name="sadness" min="1" max="10">
            </div>
            <div class="emotion">
                <label for="anger">Anger:</label>
                <input type="number" id="anger" name="anger" min="1" max="10">
            </div>
            <div class="emotion">
                <label for="fear">Fear:</label>
                <input type="number" id="fear" name="fear" min="1" max="10">
            </div>
            <div class="emotion">
                <label for="surprise">Surprise:</label>
                <input type="number" id="surprise" name="surprise" min="1" max="10">
            </div>
            <div class="emotion">
                <label for="disgust">Disgust:</label>
                <input type="number" id="disgust" name="disgust" min="1" max="10">
            </div>
            <div class="emotion">
                <label for="anticipation">Anticipation:</label>
                <input type="number" id="anticipation" name="anticipation" min="1" max="10">
            </div>
            <div class="emotion">
                <label for="trust">Trust:</label>
                <input type="number" id="trust" name="trust" min="1" max="10">
            </div> 
            <div class="emotion">
                <label for="joy">Joy:</label>
                <input type="number" id="joy" name="joy" min="1" max="10">
            </div>
            <div class="emotion">
                <label for="calm">Calm:</label>
                <input type="number" id="calm" name="calm" min="1" max="10">
            </div>
            <div class="emotion note-row">
                <label for="note">Note:</label>
                <textarea id="note" name="note" class="note-field" placeholder="Add a note..." rows="3"></textarea>
            </div>
            <button type="submit">Save Emotions</button>
        </form>

        <div class="controls">
            <button id="view-history">View History</button>
            <button id="export-json">Export JSON</button>
            <button id="import-json">Import JSON</button>
            <button id="clear-all">Clear All</button>
            <input type="file" id="import-file" accept="application/json" style="display:none">
        </div>

        <div id="emotion-display"></div>
    </div>
    <script src="app.js"></script>

        <script>
        // Improved service worker registration with fetch check and detailed logging.
        if ('serviceWorker' in navigator) {
            // Try fetching sw.js first to get clearer errors (404 or wrong MIME type)
            fetch('sw.js', { cache: 'no-store' }).then(resp => {
                if (!resp.ok) throw new Error('sw.js fetch failed: ' + resp.status + ' ' + resp.statusText);
                return navigator.serviceWorker.register('sw.js', { scope: './' });
            }).then(reg => {
                console.log('Service worker registered:', reg);
            }).catch(err => {
                console.error('Service worker registration failed:', err);
                // Show a small notice in the page to help debugging on mobile devices
                try {
                    const el = document.createElement('div');
                    el.textContent = 'Service Worker failed: ' + (err && err.message ? err.message : String(err));
                    el.style.position = 'fixed';
                    el.style.left = '12px';
                    el.style.bottom = '12px';
                    el.style.background = '#c0392b';
                    el.style.color = '#fff';
                    el.style.padding = '8px 10px';
                    el.style.borderRadius = '6px';
                    document.body.appendChild(el);
                    setTimeout(() => el.remove(), 8000);
                } catch (e) {
                    // ignore
                }
            });
        }
        </script>
</body>
</html>